<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sub-Grid Blob Autotile Demo</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #1a1a2e; color: #eee; font-family: system-ui, sans-serif; padding: 20px; }
h1 { margin-bottom: 4px; }
.subtitle { color: #aaa; margin-bottom: 16px; font-size: 14px; line-height: 1.5; }
.subtitle b { color: #ddd; }
.subtitle code { background: #2a2a4e; padding: 1px 5px; border-radius: 3px; font-size: 13px; }

/* Layout */
.controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-bottom: 12px;
  background: #16213e; padding: 10px 14px; border-radius: 8px; }
.controls label { font-size: 13px; color: #aaa; }
.controls select { background: #1a1a2e; color: #eee; border: 1px solid #444; border-radius: 4px; padding: 3px 6px; }
.controls button { background: #2a3a5e; color: #eee; border: 1px solid #444; border-radius: 4px;
  padding: 4px 10px; cursor: pointer; font-size: 12px; }
.controls button:hover { background: #3a4a7e; }

.main { display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-start; }
.canvas-wrap { position: relative; }
canvas { cursor: crosshair; border: 1px solid #333; border-radius: 4px; background: #0a0a1a; }

/* Palette */
.palette { display: flex; gap: 6px; align-items: center; }
.palette .swatch { width: 28px; height: 28px; border-radius: 4px; cursor: pointer;
  border: 2px solid transparent; transition: border-color 0.15s; position: relative; }
.palette .swatch:hover { border-color: #fff8; }
.palette .swatch.active { border-color: #fff; box-shadow: 0 0 6px #fff4; }
.palette .swatch .label { position: absolute; bottom: -14px; left: 50%; transform: translateX(-50%);
  font-size: 9px; color: #888; white-space: nowrap; pointer-events: none; }

/* Brush sizes */
.brush-row { display: flex; gap: 4px; align-items: center; }
.brush-btn { width: 32px; height: 32px; border-radius: 4px; cursor: pointer;
  border: 2px solid transparent; background: #2a3a5e; display: flex; align-items: center;
  justify-content: center; font-size: 11px; color: #ccc; }
.brush-btn:hover { background: #3a4a7e; }
.brush-btn.active { border-color: #fff; background: #3a4a7e; }

/* Info panel */
.info { min-width: 280px; max-width: 340px; background: #16213e; border-radius: 8px; padding: 14px;
  font-size: 13px; line-height: 1.6; }
.info h3 { font-size: 14px; margin-bottom: 6px; color: #8af; border-bottom: 1px solid #2a3a5e; padding-bottom: 4px; }
.info .row { display: flex; gap: 8px; margin-bottom: 2px; }
.info .lbl { color: #888; min-width: 70px; }
.info .val { color: #eee; font-family: monospace; }
.info .mask-grid { display: inline-grid; grid-template-columns: repeat(3, 18px); gap: 1px;
  font-family: monospace; font-size: 11px; text-align: center; margin: 4px 0; }
.info .mask-grid .bit { width: 18px; height: 18px; line-height: 18px; border-radius: 2px; }
.info .mask-grid .bit.on { background: #4a7a2a; color: #fff; }
.info .mask-grid .bit.off { background: #333; color: #666; }
.info .mask-grid .bit.center { background: #2a2a4e; color: #888; }
.info .sep { height: 8px; }

/* Presets */
.presets { margin-top: 16px; background: #16213e; border-radius: 8px; padding: 12px 14px; }
.presets h3 { font-size: 14px; margin-bottom: 8px; color: #8af; }
.preset-row { display: flex; gap: 6px; flex-wrap: wrap; }
.preset-btn { background: #2a3a5e; color: #eee; border: 1px solid #444; border-radius: 4px;
  padding: 4px 10px; cursor: pointer; font-size: 12px; }
.preset-btn:hover { background: #3a4a7e; }
.preset-desc { margin-top: 6px; font-size: 12px; color: #999; min-height: 18px; }

/* Reference */
.reference { margin-top: 20px; background: #16213e; border-radius: 8px; padding: 14px; }
.reference h3 { font-size: 14px; margin-bottom: 8px; color: #8af; }
.ref-info { font-size: 12px; color: #888; margin-bottom: 10px; }
.ref-grid { display: grid; grid-template-columns: repeat(12, 56px); gap: 2px; }
.ref-cell { text-align: center; border-radius: 3px; padding: 2px; }
.ref-cell canvas { display: block; margin: 0 auto 2px; border-radius: 2px; }
.ref-cell .mask-num { font-family: monospace; font-size: 10px; color: #aaa; }
.ref-cell.highlight { background: #3a4a7e; }
.ref-cell.unused { opacity: 0.3; }

/* Legend */
.legend { display: flex; gap: 16px; margin: 8px 0 12px; flex-wrap: wrap; font-size: 12px; }
.legend-item { display: flex; align-items: center; gap: 5px; }
</style>
</head><body>

<h1>Sub-Grid Blob Autotile Demo</h1>
<p class="subtitle">
  Interactive explorer for the <b>double-density sub-grid</b> autotile system.<br>
  Each tile's 8-bit blob mask is read directly from 8 surrounding sub-grid points.<br>
  <b>Corner</b> points (even,even) only affect diagonal bits. <b>Midpoints</b> (mixed parity) control cardinal bits.<br>
  A lone corner does nothing visible (diagonal bits require adjacent cardinals). Midpoints are the fundamental unit.<br>
  <b>Modes:</b> <code>Z</code> Positive (fills in) &middot; <code>X</code> Negative (terrain becomes base, enables reverse sheets) &middot; <code>C</code> Unpaint (erases specific terrain).
  <b>Shapes:</b> <code>1-5</code> for point/2x2/3x3/cross/tile.<br>
  <b>Uses the real game algorithm</b> &mdash; changes to <code>src/autotile/</code> are reflected here via Vite HMR.
</p>

<div class="legend">
  <div class="legend-item">
    <svg width="18" height="18"><rect x="3" y="3" width="12" height="12" rx="2" fill="#6b935f" stroke="#fff8" stroke-width="1.5"/></svg>
    <span>Center (tile terrain)</span>
  </div>
  <div class="legend-item">
    <svg width="18" height="18"><rect x="3" y="5" width="12" height="8" rx="2" fill="#6b935f" stroke="#fff8" stroke-width="1.5" transform="rotate(45 9 9)"/></svg>
    <span>Midpoint (cardinal edge)</span>
  </div>
  <div class="legend-item">
    <svg width="18" height="18"><circle cx="9" cy="9" r="5" fill="#6b935f" stroke="#fff8" stroke-width="1.5"/></svg>
    <span>Corner (diagonal)</span>
  </div>
</div>

<div class="controls">
  <label>Paint:</label>
  <div class="palette" id="palette"></div>
  <span style="color:#444">|</span>
  <label>Base:</label>
  <select id="baseSel"></select>
  <span style="color:#444">|</span>
  <label>Mode:</label>
  <div class="brush-row" id="modeRow">
    <div class="brush-btn active" data-mode="positive" title="Positive: terrain fills in [Z]">+</div>
    <div class="brush-btn" data-mode="negative" title="Negative: terrain becomes base [X]">&minus;</div>
    <div class="brush-btn" data-mode="unpaint" title="Unpaint: erase specific terrain [C]">&times;</div>
  </div>
  <span style="color:#444">|</span>
  <label>Shape:</label>
  <div class="brush-row" id="shapeRow">
    <div class="brush-btn active" data-shape="grid1" title="Single point [1]">&middot;</div>
    <div class="brush-btn" data-shape="grid2" title="2x2 block [2]">2x2</div>
    <div class="brush-btn" data-shape="grid3" title="3x3 block [3]">3x3</div>
    <div class="brush-btn" data-shape="cross" title="Cross pattern [4]">&#10010;</div>
    <div class="brush-btn" data-shape="tile" title="Full tile [5]">&#9632;</div>
  </div>
  <span style="color:#444">|</span>
  <label>Grid:</label>
  <select id="gridSel">
    <option value="2">2x2</option>
    <option value="3" selected>3x3</option>
    <option value="4">4x4</option>
    <option value="5">5x5</option>
  </select>
  <span style="color:#444">|</span>
  <label><input type="checkbox" id="showSheets" checked> Sheets</label>
  <label><input type="checkbox" id="showMasks"> Masks</label>
  <button id="clearBtn">Clear</button>
  <button id="shareBtn">Copy URL</button>
</div>

<div class="main">
  <div class="canvas-wrap">
    <canvas id="canvas"></canvas>
  </div>
  <div class="info" id="info">
    <h3>Hovered Tile</h3>
    <div id="tileInfo"><span style="color:#666">Hover over a tile to see details</span></div>
    <div class="sep"></div>
    <h3>Hovered Point</h3>
    <div id="pointInfo"><span style="color:#666">Hover over a sub-grid point</span></div>
  </div>
</div>

<div class="presets">
  <h3>Presets (click to load)</h3>
  <div class="preset-row" id="presetRow"></div>
  <div class="preset-desc" id="presetDesc"></div>
</div>

<div class="reference">
  <h3>All 47 GM Blob Shapes</h3>
  <div class="ref-info">12x4 grid from ME autotile sheet. Mask number below each tile. Highlighted = currently used by a tile in the interactive grid.</div>
  <div class="ref-grid" id="refGrid"></div>
</div>

<script type="module" src="./subgrid.ts"></script>
</body></html>
